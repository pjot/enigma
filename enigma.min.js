var b={p:37,w:38,r:39,l:40,NONE:"none"},d={d:"floor",g:"wall",f:"hole",h:"player",c:"coin",ONE:"1",v:"2",u:"3",o:"4",n:"5",t:"6",s:"7",m:"8",q:"9",ZERO:"0",i:"slash",j:"titlebar",A:function(){var a=0;for(item in d)d.hasOwnProperty(item)&&"string"==typeof d[item]&&a++;return a}};window.D=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1E3/60)};
var e={images:[d.h,d.d,d.f,d.g,d.c,d.ONE,d.v,d.u,d.o,d.n,d.t,d.s,d.m,d.q,d.ZERO,d.i,d.j],z:function(a,c){var l=0;return function(){++l==a&&c()}},C:function(a){a=e.z(d.A(),a);for(image in e.images)imageName=e.images[image],e[imageName]=new Image,e[imageName].src="images/"+imageName+".png",e[imageName].addEventListener("load",a)},B:function(a){return e[a]}};function f(a,c,l){this.x=a;this.y=c;this.type=l}
f.prototype.move=function(){var a=g(this.x,this.y);switch(a.type){case d.c:h++;a.type=d.d;a=0;for(tile in j)j[tile].type==d.c&&a++;if(0==a){console.log("Won!");k=1;return}break;case d.f:console.log("Dead!");k=1;return}a=g(this.x+this.a,this.y+this.b);!1==a||a.type==d.g?(this.b=this.a=0,k=1):(this.x+=this.a,this.y+=this.b)};function m(a){n.drawImage(e.B(a.type),a.x*p,a.y*p+q)}var r={name:1,k:[4,3],e:{}};r.e[d.g]=[[1,1],[2,2],[3,2],[12,3],[12,1],[3,3],[8,6],[11,6],[18,5],[3,0],[4,4],[5,5],[6,6]];
r.e[d.c]=[[11,4],[0,1],[6,0],[7,0],[8,0],[9,0],[10,0],[11,0],[12,0],[13,0]];r.e[d.f]=[[1,2],[2,3],[3,4],[4,5],[5,6],[6,7],[7,8],[17,9]];var p=20,q=20,k=0,s=document.getElementById("game"),j=[],u,v,w=b.NONE,z=0,h=0,A=0,B=0;function g(a,c){for(tile in j)if(j[tile].x==a&&j[tile].y==c)return j[tile];return!1}
function C(){var a=j;for(tile in a){var c=a[tile];m(new f(c.x,c.y,d.d));m(a[tile])}m(E);var a=h+"",c=0,l=A+"",F=z+"";for(i=0;i<u;i++)t=new f(i,-1,d.j),m(t);for(letter in F)t=new f(c,-1,F[letter]),m(t),c++;for(letter in a)c++,t=new f(c,-1,a[letter]),m(t);c++;t=new f(c,-1,d.i);m(t);for(letter in l)c++,t=new f(c,-1,l[letter]),m(t)}function G(a){event=a||window.event;for(key in b)if(event.keyCode==b[key]){w=b.NONE;break}}
function H(a){event=a||window.event;for(key in b)if(event.keyCode==b[key]&&event.keyCode!=w){w=b[key];break}}function I(a){var c=1E3/(a-B);B=a;document.getElementById("fps").innerHTML=Math.floor(c);window.D(I);if(0!==k){2==k&&E.move();if(w!=b.NONE&&1==k){a=E;c=w;a.a=0;a.b=0;switch(c){case b.w:a.b=-1;break;case b.l:a.b=1;break;case b.p:a.a=-1;break;case b.r:a.a=1}k=2}C()}}var n,J,K,E,B=+new Date;
e.C(function(){n=s.getContext("2d");J=s.attributes.height.value;K=s.attributes.width.value;u=K/p;v=(J-q)/p;z=r.name;var a=r.e,c=[];for(tileType in a)for(row in a[tileType])c.push(new f(a[tileType][row][0],a[tileType][row][1],tileType));j=c;for(x=0;x<u;x++)for(y=0;y<v;y++)!1==g(x,y)&&c.push(new f(x,y,d.d));j=c;E=new f(r.k[0],r.k[1],d.h);E.a=0;A=E.b=0;for(tile in j)j[tile].type==d.c&&++A;C();k=1;document.onkeydown=H;document.onkeyup=G});I(+new Date);