var c={B:37,J:38,D:39,u:40,NONE:"none"},f={g:"floor",k:"wall",j:"hole",n:"player",f:"coin",ONE:"1",I:"2",H:"3",z:"4",w:"5",G:"6",F:"7",v:"8",C:"9",ZERO:"0",o:"slash",p:"titlebar",M:function(){var b=0;for(item in f)f.hasOwnProperty(item)&&"string"==typeof f[item]&&b++;return b}};window.P=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(b){window.setTimeout(b,1E3/60)};
var g={images:[f.n,f.g,f.j,f.k,f.f,f.ONE,f.I,f.H,f.z,f.w,f.G,f.F,f.v,f.C,f.ZERO,f.o,f.p],L:function(b,d){var e=0;return function(){++e==b&&d()}},O:function(b){b=g.L(f.M(),b);for(image in g.images)imageName=g.images[image],g[imageName]=new Image,g[imageName].src="images/"+imageName+".png",g[imageName].addEventListener("load",b)},N:function(b){return g[b]}};function h(b,d,e){this.x=b;this.y=d;this.type=e}
h.prototype.move=function(){var b=j(window.a,this.x,this.y);switch(b.type){case f.f:window.a.t++;b.type=f.g;var b=window.a,d=0;for(tile in b.b)b.b[tile].type==f.f&&d++;if(0==d){console.log("Won!");window.a.state=1;return}break;case f.j:console.log("Dead!");window.a.state=1;return}b=j(window.a,this.x+this.d,this.y+this.e);!1==b||b.type==f.k?(this.e=this.d=0,window.a.state=1):(this.x+=this.d,this.y+=this.e)};
function l(b){window.a.canvas.drawImage(g.N(b.type),b.x*window.a.h,b.y*window.a.h+window.a.q)}var m={name:1,c:[4,3],b:{}};m.b[f.k]=[[1,1],[2,2],[3,2],[12,3],[12,1],[3,3],[8,6],[11,6],[18,5],[3,0],[4,4],[5,5],[6,6]];m.b[f.f]=[[11,4],[0,1],[6,0],[7,0],[8,0],[9,0],[10,0],[11,0],[12,0],[13,0]];m.b[f.j]=[[1,2],[2,3],[3,4],[4,5],[5,6],[6,7],[7,8],[17,9]];function n(b){p=c.NONE;this.q=this.h=20;this.state=0;this.l=b;this.b=[];this.i={};this.timestamp=this.m=this.t=this.r=0}var p;
function j(b,d,e){for(tile in b.b)if(b.b[tile].x==d&&b.b[tile].y==e)return b.b[tile];return!1}function q(b,d){for(tile in d){var e=d[tile];l(new h(e.x,e.y,f.g));l(d[tile])}l(b.c);var e=b.t+"",k=0,r=b.m+"",s=b.r+"";for(i=0;i<b.i.x;i++)t=new h(i,-1,f.p),l(t);for(letter in s)t=new h(k,-1,s[letter]),l(t),k++;for(letter in e)k++,t=new h(k,-1,e[letter]),l(t);k++;t=new h(k,-1,f.o);l(t);for(letter in r)k++,t=new h(k,-1,r[letter]),l(t)}
function u(b){event=b||window.event;for(key in c)if(event.keyCode==c[key]){p=c.NONE;break}}function v(b){event=b||window.event;for(key in c)if(event.keyCode==c[key]&&event.keyCode!=p){p=c[key];break}}
n.prototype.start=function(){this.timestamp=+new Date;g.O(function(){var b=window.a;b.canvas=b.l.getContext("2d");b.A=b.l.attributes.height.value;b.K=b.l.attributes.width.value;b.i={x:b.K/b.h,y:(b.A-b.q)/b.h};b.r=m.name;var d=m.b,e=[];for(tileType in d)for(row in d[tileType])e.push(new h(d[tileType][row][0],d[tileType][row][1],tileType));b.b=e;for(x=0;x<b.i.x;x++)for(y=0;y<b.i.y;y++)!1==j(b,x,y)&&e.push(new h(x,y,f.g));b.b=e;b.c=new h(m.c[0],m.c[1],f.n);b.c.d=0;b.c.e=0;b.m=0;for(tile in b.b)b.b[tile].type==
f.f&&++b.m;q(b,b.b);b.state=1;document.onkeydown=v;document.onkeyup=u});this.s(+new Date)};n.prototype.s=function(b){var d=1E3/(b-this.timestamp);this.timestamp=b;document.getElementById("fps").innerHTML=Math.floor(d);window.P(window.a.s);if(0!==window.a.state){b=window.a;2==b.state&&b.c.move();b=window.a;if(p!=c.NONE&&1==b.state){var d=b.c,e=p;d.d=0;d.e=0;switch(e){case c.J:d.e=-1;break;case c.u:d.e=1;break;case c.B:d.d=-1;break;case c.D:d.d=1}b.state=2}q(window.a,window.a.b)}};window.a=new n(document.getElementById("game"));
window.a.start();